{% extends "base.html" %}

{% block nav_movies %}active{% endblock %}

{% block header %}
<h3>Movies</h3>
<div class="d-flex align-items-center">
  <div class="dropdown">
    <button class="btn btn-secondary dropdown-toggle btn-sm" type="button" data-toggle="dropdown" aria-haspopup="true"
      aria-expanded="false" style="height: 100%">
      Menu
    </button>
    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
      <a class="dropdown-item" href="{{ url_for('main.movies_export') }}">Export .csv</a>
      <a class="dropdown-item" href="#">Another action</a>
      <a class="dropdown-item" href="#">Something else here</a>
    </div>
  </div>
  <button id="myBtn" class="btn btn-secondary ml-1 btn-sm">
    <i class="fa fa-refresh" aria-hidden="true"></i>
    Refresh
  </button>
  <a href="{{ url_for('main.movie_create') }}" class="btn btn-primary ml-1 btn-sm">
    <i class="fa fa-plus-square" aria-hidden="true"></i>
    Create
  </a>
</div>
{% endblock %}

{% block content %}
<div id="toolbar">
  <button id="btnGetSelected" class="btn btn-secondary btn-sm">getSelections</button>
</div>
<table id="table" data-toggle="table" data-url="{{ url_for('main.api', doctype='movies') }}" data-search="true"
  data-sort-name="rating_value" data-sort-order="desc" data-show-columns="true" data-page-list="[10, 25, 50, 100]"
  data-icon-size="sm" data-pagination="true" data-toolbar="#toolbar" data-side-pagination="server">
  <!-- data-side-pagination="server" -->
  <thead class="text-muted">
    <tr>
      <th data-field="state" data-checkbox="true"></th>
      <th data-field="fav" data-formatter="favFormatter" data-events="operateEvents" data-align="center"><i
          class="fa fa-heart text-secondary"></i></th>
      <th data-field="title" data-formatter="titleFormatter" data-sortable="true">Title</th>
      <th data-field="year" data-sortable="true">Year</th>
      <th data-field="director" data-sortable="true">Director</th>
      <th data-field="category" data-sortable="true">Category</th>
      <th data-field="rating_value" data-sortable="true">Rating</th>
      <th data-field="certificate" data-sortable="true" data-visible="false">Certificate</th>
      <th data-field="runtime" data-sortable="true" data-visible="false">Runtime (min)</th>
    </tr>
  </thead>
</table>
{% endblock %}

{% block script %}
<script src="{{url_for('static', filename='table_utils.js')}}"></script>
<script>
  // cell formatters
  function favFormatter(value, row, index) {
    return [
      '<a class="like text-secondary" href="javascript:void(0)" title="Like">',
      '<i class="fa fa-heart fa-sm"></i>',
      '</a>'
    ].join('')
  }
  function titleFormatter(value, row, index) {
    return [
    '<div class="media">',
    '  <img src="', row.poster_url, '" class="align-self-center mr-2" alt="Poster" style="height:48px;">',
    '  <div class="media-body align-self-center">',
    '    <a href="/movie/', row.id, '" title="Show details">', value, '</a>',
    '  </div>',
    '</div>',
    ].join('')
  }
</script>
{% endblock %}